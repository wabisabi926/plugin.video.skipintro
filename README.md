# 跳过片头插件

Kodi 的 Skip Intro Addon 可通过多种检测方法和智能数据库系统智能检测、记忆和跳过电视节目的开场白。

## 特点

- **智能显示检测**

  - 自动识别电视节目和剧集
  - 支持 Kodi 元数据和文件名解析
  - 支持常见的命名格式（SxxExx、xxXxx）

- **简介/外展管理**

- 保存每一集的开场白/片尾曲时间
  - 重复使用保存的时间，以便将来播放
  - 多种检测方法：
    - 保存时间数据库
    - 章节标记
    - 可配置的默认时间
    - 支持在线应用程序接口（即将推出）

- **用户友好界面**

　- 右下方的跳过按钮干净利落、重点突出
  - 自动聚焦，可立即跳过
  - 可与遥控器、键盘和鼠标配合使用
  - 平滑的淡入/淡出动画
  - 非侵入式设计

- **技术特点**
  - 使用本地 Kodi 事件高效追踪时间
  - 用于高效存储的 SQLite 数据库
  - 智能持续时间解析（HH:MM:SS、MM:SS）
  - 全面的错误处理
  - 详细日志记录
  - 完全本地化支持

## 安装

1. **下载插件：**

   - 前往 [Releases](https://github.com/amgadabdelhafez/plugin.video.skipintro/releases) 部分
   - 下载最新版本的 zip 文件

2. **在 Kodi 中安装：**

   - 打开 Kodi > 插件
   - 点击 “软件包”图标（左上角）
   - 选择 “从压缩文件安装”
   - 导航至下载的压缩文件
   - 等待安装确认

3. **启用插件：**
   - 转到设置 > 附加组件
   - 在视频插件下找到“跳过介绍”
   - 启用插件

## 配置

本插件提供三类设置：

1. **片头跳过设置**

   - **提示前延迟**（0-300秒）
     - 显示跳过提示前的等待时间
     - 默认值：30秒
   - **跳过时长**（10-300秒）
     - 使用默认跳过功能时向前跳过的时间
     - 默认值：60秒

2. **数据库设置**

   - **数据库位置**
     - 存储节目数据库的位置
     - 默认值：special://userdata/addon_data/plugin.video.skipintro/shows.db
   - **使用章节标记**
     - 启用/禁用基于章节的检测
     - 默认值：启用
   - **使用在线API**
     - 启用/禁用在线时间源（即将推出）
     - 默认值：禁用
   - **保存时间**
     - 是否保存检测到的时间供将来使用
     - 默认值：启用

3. **节目设置**
   - **使用节目默认值**
     - 对所有集使用相同的片头/片尾时间
     - 默认值：启用
   - **使用章节编号**
     - 使用章节编号代替时间戳
     - 默认值：禁用
   - **默认片头时长**
     - 使用节目默认值时的片头时长
     - 默认值：60秒

## 工作原理

本插件使用多种方法来检测和跳过片头：

1. **数据库查找**：

   - 识别当前节目和集数
   - 检查数据库中是否有保存的时间
   - 如有保存的时间则使用

2. **章节检测**：

   - 查找名为"Intro End"（片头结束）的章节
   - 找到后，提供跳转到该点的选项
   - 可以保存时间供将来使用

3. **手动输入**：

   有两种方式可以访问时间输入功能：

   1. 通过跳过片头按钮：

      - 当跳过按钮出现时，按菜单/信息键
      - 选择章节或输入手动时间
      - 时间将保存供将来播放使用

   2. 通过媒体库上下文菜单：
      - 在Kodi的电视节目库中，选择一个节目或集
      - 按'C'键或右键点击打开上下文菜单
      - 选择"设置节目时间"
      - 如果文件有章节：
        - 选择片头开始/结束的章节
        - 选择片尾开始的章节（可选）
        - 时间将自动保存
      * 如果没有章节可用：
        - 输入片头开始时间和时长
        - 输入片尾开始时间（可选）
        - 选择是否对所有集使用这些时间

   设置时间时，如果章节可用：

   - 系统会提示您选择以下章节：
     - 片头开始：片头开始的位置
     - 片头结束：片头结束的位置
     - 片尾开始：片尾字幕开始的位置
   - 会显示章节名称和时间戳
   - 选择章节会自动设置时间

   如果没有章节可用，或者您更喜欢手动输入：

   - 以MM:SS格式输入以下时间：
     - 片头开始时间
     - 片头时长
     - 片尾开始时间（可选）
   - 选择是否对所有集使用这些时间

   所有时间都保存在数据库中，并用于该节目的将来播放。

4. **默认跳过**：

   - 如果没有找到其他时间，将回退到配置的延迟时间
   - 延迟时间后显示跳过按钮
   - 可选择保存用户确认的时间

5. **在线API**（即将推出）：
   - 将从在线数据库获取片头/片尾时间
   - 需要API密钥（尚未实现）

## 仓库设置

要启用自动更新：

1. **添加仓库**：

   - 在Kodi中 > 插件 > 包图标
   - 选择"从zip文件安装"
   - 导航到`repository.plugin.video.skipintro.zip`
   - 等待安装完成

2. **更新**：
   - Kodi将自动检查更新
   - 通过Kodi的插件管理器安装更新

## 开发

### 要求

- Python 3.x
- Kodi 19（Matrix）或更高版本

### 测试

本插件包含全面的单元测试：

```bash
python3 test_video_metadata.py -v
```

### 构建

使用附带的构建脚本：

```bash
./build.sh
```

这将：

- 创建插件zip文件
- 生成仓库文件
- 更新版本信息

### 项目结构

```
plugin.video.skipintro/
├── addon.xml           # 插件元数据和依赖项
├── default.py         # 主要插件代码
├── resources/
│   ├── lib/
│   │   ├── database.py   # 数据库操作
│   │   └── metadata.py   # 节目检测
│   ├── settings.xml   # 设置定义
│   └── language/      # 本地化文件
├── tests/             # 单元测试
└── build.sh          # 构建脚本
```

## 贡献

1. Fork 仓库
2. 创建功能分支
3. 进行修改
4. 添加/更新测试
5. 提交拉取请求

## 许可证

本项目采用MIT许可证授权。

## 变更日志

### v1.3.8（2025-02-19）

- 修复了设置解析错误
- 改进了数据库迁移过程
- 解决了基于章节的跳过时间选择问题

### v1.3.7（2025-02-19）

- 改进了基于章节的跳过时间选择
- 增强了数据库对基于章节配置的支持
- 修复了保存和检索基于章节设置的问题

### v1.3.6（2025-02-19）

- 修复了基于章节的跳过时间选择
- 通过使用直接章节编号输入提高了可靠性

### v1.3.5（2025-02-19）

- 恢复了基于章节设置跳过时间的功能
- 添加了在手动时间输入和基于章节选择之间进行选择的选项
- 更新了用户界面以改善用户体验

### v1.3.4（2025-02-19）

- 首次尝试修复数据库架构问题

### v1.3.3

- 修复了设置手动跳过时间的问题
- 改进了新节目条目的数据库结构
- 增强了错误处理和日志记录，以便更好地诊断问题
- 添加了保存配置的验证
- 更新了文档

### v1.3.2

- 改进了跳过按钮的用户界面和位置
- 添加了平滑淡入淡出动画
- 切换到原生Kodi事件系统
- 更好的性能和可靠性
- 改进了用于故障排除的日志记录
- 修复了播放期间的时间问题

### v1.3.0

- 添加了节目级别的默认时间
- 添加了基于时长的跳过
- 添加了章节编号支持
- 改进了数据库持久性
- 更好的章节名称处理
- 修复了播放期间的时间问题
- 更新了文档

### v1.2.93

- 添加了HH:MM:SS时长解析
- 使用滑块和验证改进了设置
- 添加了全面的错误处理
- 添加了本地化支持
- 改进了内存管理
- 添加了单元测试

## 故障排除

如果您在设置手动跳过时间时遇到任何问题：

1. 尝试再次为节目设置手动跳过时间。
2. 如果问题仍然存在，请检查Kodi日志文件以获取有关该过程的详细信息。查找以"SkipIntro:"开头的日志条目。
3. 如果您仍然遇到问题，请在我们的GitHub问题页面上报告，包括相关的日志条目以便进一步调查。
